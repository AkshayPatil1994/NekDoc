

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FAQ &mdash; Nek5000 17.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Nek5000 17.0 documentation" href="index.html"/>
        <link rel="next" title="Appendices" href="appendix.html"/>
        <link rel="prev" title="Theory" href="theory.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Nek5000
          

          
          </a>

          
            
            
              <div class="version">
                17.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="case_files.html">Case Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Mesh Generation and Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-compiling-and-running">Installing, Compiling, and Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-processing">Pre-Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-setup">Problem Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#physical-models">Physical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computational-speed">Computational Speed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing">Post-Processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nek5000</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>FAQ</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/faq.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="faq">
<span id="id1"></span><h1>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p><strong>How can I properly reference Nek5000?</strong></p>
<blockquote>
<div>If you use our software, please cite the following:</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">NEK5000</span> <span class="n">Version</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span> <span class="n">Release</span> <span class="n">date</span><span class="o">.</span> <span class="n">Argonne</span> <span class="n">National</span> <span class="n">Laboratory</span><span class="p">,</span> <span class="n">Illinois</span><span class="o">.</span>
<span class="n">Available</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nek5000</span><span class="o">.</span><span class="n">mcs</span><span class="o">.</span><span class="n">anl</span><span class="o">.</span><span class="n">gov</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>What is the license for Nek5000?</strong></p>
<blockquote>
<div>Nek5000 is licensed under BSD.
For more information see the <code class="docutils literal"><span class="pre">LICENSE</span></code> file included with the distribution in the root level directory.</div></blockquote>
<p><strong>Where can I find support or ask questions about Nek5000?</strong></p>
<blockquote>
<div>For any questions not answered in this document, you can email the Nek5000 community at large via the <a class="reference external" href="https://lists.mcs.anl.gov/mailman/listinfo/nek5000-users">mailing list</a>.</div></blockquote>
</div>
<div class="section" id="installing-compiling-and-running">
<h2>Installing, Compiling, and Running<a class="headerlink" href="#installing-compiling-and-running" title="Permalink to this headline">¶</a></h2>
<p><strong>Which platforms are supported by Nek5000?</strong></p>
<blockquote>
<div>All posix compliant operations system.
Compiling and running on Microsoft Windows 10 has been demonstrated using CMake and MinGW, although this is <strong>not</strong> supported.</div></blockquote>
<p><strong>Which compilers work?</strong></p>
<blockquote>
<div>Currently GNU, Intel, PGI and IBM compilers are supported.</div></blockquote>
<p><strong>How much memory is required?</strong></p>
<p>The memory footprint of a run depends on many factors and is printed to
screen whenever Nek5000 exits. What follows is a rough a-priori estimate:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">lx1</span><span class="o">*</span><span class="n">ly1</span><span class="o">*</span><span class="n">lz1</span><span class="o">*</span><span class="n">lelt</span> <span class="o">*</span> <span class="mi">3000</span><span class="n">byte</span> <span class="o">+</span> <span class="n">lelg</span> <span class="o">*</span> <span class="mi">12</span><span class="n">byte</span> <span class="o">+</span> <span class="n">MPI</span>
</pre></div>
</div>
<p>The memory allocated by MPI will depend heavily on the total number of
ranks and the considered MPI implementation. For large ranks counts (say &gt; 100‘000) it’s
easily 50-100MB.</p>
<p>Note, the output of GNU`s SIZE utility is inaccurate as it does not
take into account the dynamic memory alloation of MPI, gslib, CVODE, etc.</p>
<p><strong>Why does the compiler issue relocation errors?</strong></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">relocation</span> <span class="pre">truncated</span> <span class="pre">to</span> <span class="pre">fit:</span> <span class="pre">R_X86_64</span> <span class="pre">against</span> <span class="pre">symbol</span> <span class="pre">'foo_'</span> <span class="pre">defined</span> <span class="pre">in</span> <span class="pre">COMMON</span> <span class="pre">section</span> <span class="pre">in</span> <span class="pre">obj/bar.o</span></code></p>
<p>This happens when the resultant executable requires more memory allocation than available, usually because <code class="docutils literal"><span class="pre">lelt</span></code> is too large.
The best way to avoid this is to increase the minimum number of MPI ranks, <code class="docutils literal"><span class="pre">lpmin</span></code> in <code class="docutils literal"><span class="pre">SIZE</span></code>.
Alternatively, you can add <code class="docutils literal"><span class="pre">-mcmodel=medium</span></code> to the <code class="docutils literal"><span class="pre">FFLAGS</span></code> variable in <code class="docutils literal"><span class="pre">makenek</span></code>.</p>
</div></blockquote>
<p><strong>How do I launch a parallel run?</strong></p>
<blockquote>
<div>Assuming your machine has MPI configured correctly and you have pointed your <code class="docutils literal"><span class="pre">makenek</span></code> file to the correct compilers, parallel runs can be launced with the included <code class="docutils literal"><span class="pre">nekmpi</span></code> and <code class="docutils literal"><span class="pre">nekbmpi</span></code> scripts.
If you are running on a cluster, consult your sysadmin to write an appropriate submission script.</div></blockquote>
<p><strong>How do I run the examples?</strong></p>
<blockquote>
<div>The examples are included by default in the release tarball (see example directory). There is nothing special you need
to do as they are ready to run.</div></blockquote>
</div>
<div class="section" id="pre-processing">
<h2>Pre-Processing<a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h2>
<p><strong>How can I generate a mesh for use with Nek5000?</strong></p>
<blockquote>
<div>Please see the section on <a class="reference internal" href="geometry.html#mesh-gen"><span class="std std-ref">Mesh Generation and Conversion</span></a>.</div></blockquote>
<p><strong>What element types are supported?</strong></p>
<blockquote>
<div>Conformal curved quadrilateral/hexahedral elements.</div></blockquote>
<p><strong>How do I convert a mesh to Nek5000?</strong></p>
<blockquote>
<div>We currently support conversion from the exodus file format with the <code class="docutils literal"><span class="pre">exo2nek</span></code> utility.</div></blockquote>
</div>
<div class="section" id="problem-setup">
<h2>Problem Setup<a class="headerlink" href="#problem-setup" title="Permalink to this headline">¶</a></h2>
<p><strong>Why is it important to non-dimensionalize my case?</strong></p>
<blockquote>
<div>Nek5000 can be run with dimensions, but we STRONGLY recommend that the case has been non-dimensionalized properly.
An advantage of the nondimensional form is that physical simulation times, tolerances, etc. tend to
obtains the nondimensional form be easy to set based on prior experience with other simulations.</div></blockquote>
<p><strong>How do I choose solver tolerances?</strong></p>
<blockquote>
<div>Depends on how accurate you need your simulation to be.
Typical values (for engineering type of problems) are <span class="math">\(10^{-7}\)</span> for velocity and scalars.
In Pn/Pn-2 the pressure tolerance is equal to error in divergence. This is contrast to Pn/Pn where the divergence
error is mainly a function of spatial resolution and a tolerance of <span class="math">\(10^{-4}\)</span> is typically good enough.
Note the tolerances are related to the residual in the linear solve and do not represent the accuracy of the solution.</div></blockquote>
<p><strong>What formulation Pn/Pn or Pn/Pn-2 should I use?</strong></p>
<blockquote>
<div>There is no simple answer but we typically recommend to use the Pn/Pn formulation altough not all features are
supported (at least for now).</div></blockquote>
<p><strong>What polynomial order should I use?</strong></p>
<blockquote>
<div>This depends what you are after. The code supports a large range of polynomial orders e.g. <cite>N=1-32</cite> but the sweet spot
is typically <span class="math">\(N=7\)</span> (lx1=8). Unless you have a very good reason to change it do not deviate from this best partice.
Note, do not use <span class="math">\(N&lt;5\)</span> as this results in a very poor performance.</div></blockquote>
<p><strong>How do I specify/change the polynomial order?</strong></p>
<blockquote>
<div>Change <code class="docutils literal"><span class="pre">lx1</span></code> in the SIZE file. Note, the polynomial order is <span class="math">\(N=lx1-1\)</span>.</div></blockquote>
<p><strong>How do I specify/change the solver runtime parameters?</strong></p>
<blockquote>
<div>See the section on the <a class="reference internal" href="case_files.html#case-files-par"><span class="std std-ref">par</span></a> file.</div></blockquote>
<p><strong>Why is ``userbc`` only called for certain element faces?</strong></p>
<blockquote>
<div><code class="docutils literal"><span class="pre">userbc</span></code> is ONLY called for element boundary conditions specified with a lower-case letter, e.g. ‘v’, ‘t’, or ‘o’ but NOT ‘W’, ‘E’, or ‘O’.  Note that this implies it is not necesarily called on all MPI ranks.</div></blockquote>
</div>
<div class="section" id="physical-models">
<h2>Physical Models<a class="headerlink" href="#physical-models" title="Permalink to this headline">¶</a></h2>
<p><strong>How do I solve for a scalar?</strong></p>
<blockquote>
<div>Nek5000 supports solving up to 99 additional scalars.
To solve an additional scalar equation, increase <code class="docutils literal"><span class="pre">ldimt</span></code> in the <code class="docutils literal"><span class="pre">SIZE</span></code> file to accomodate the additional scalar and specify the appropriate parameter in the <a class="reference internal" href="case_files.html#case-files-par"><span class="std std-ref">par</span></a> file.</div></blockquote>
<p><strong>What turbulence models are available in Nek5000?</strong></p>
<blockquote>
<div>For LES we provide an explicit filtering approach or a relaxation term model.
RANS turbulence models (k-ω, k-ω SST, etc.) are not an integral part of the code but available through the examples.</div></blockquote>
</div>
<div class="section" id="computational-speed">
<h2>Computational Speed<a class="headerlink" href="#computational-speed" title="Permalink to this headline">¶</a></h2>
<p><strong>How many elements should I have per processes?</strong></p>
<blockquote>
<div>The upper limit is given by the available memory. The lower limit is (technically) 1 but you may want to have more
elements (work) to get a reasonable (whatever that means for you) parallel efficiency.
On most machines you need more than 10 elements per MPI rank to get a parallel efficiency of 0.5 (assuming N=7).</div></blockquote>
<p><strong>Should I use residual projection?</strong></p>
<blockquote>
<div>This depends, you may want to turn it on e.g. for pressure but noti for velocity. All this is case specific and a simple
experiment will show if it pays off or not.</div></blockquote>
<p><strong>What can I do to get best performance?</strong></p>
<blockquote>
<div><ul class="simple">
<li>Design your mesh for a polynomial order N=7</li>
<li>Reduce polynomial order used for overintegration (strict 3/2 rule might be overly conservative)</li>
<li>Fine tune the number of elements per MPI rank to get a reasonable parallel efficiency</li>
<li>Use AMG instead of XXT as coarse grid solver</li>
<li>Avoid unnecessary time consuming operations in <code class="docutils literal"><span class="pre">usrchk/userbc</span></code></li>
<li>Enable tuned MxM implementation for your platform (see <code class="docutils literal"><span class="pre">makenek</span></code> options)</li>
<li>Compile with vector instructions like AVX, AVX2 using FFLAGS and CFLAGS in makenek</li>
<li>Try to use residual projection</li>
<li>Tune your solver tolerances</li>
<li>Increase time step size (target Courant number 2-4) by switching to 2nd order BDF and OIFS extrapolation</li>
<li>Use binary input files e.g. <code class="docutils literal"><span class="pre">.re2</span></code> and <code class="docutils literal"><span class="pre">.ma2</span></code> to minimize solver initialization time</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p><strong>My simulation diverges. What should I do?</strong></p>
<blockquote>
<div><p>There are many potential root causes but here are some things you can experiment with:</p>
<ul class="simple">
<li>lower the time step (in particular during initial transients)</li>
<li>reduce time integration order (e.g. use 2 instead of 3)</li>
<li>increase spatial resolution</li>
<li>provide a better initial condition</li>
<li>check that your boundary conditions are meaningful and correctly implemented</li>
<li>visualize the solution and look for unexpected anomalies</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="post-processing">
<h2>Post-Processing<a class="headerlink" href="#post-processing" title="Permalink to this headline">¶</a></h2>
<p><strong>The local coordinate axes of my elements are not aligned with the global coordinate system, is this normal?</strong></p>
<blockquote>
<div>Yes, there is no guarantee that the elements are generated with any particular orientation (except if you use genbox).</div></blockquote>
<p><strong>Where are my solution files and how do I visualize them?</strong></p>
<blockquote>
<div>By default Nek5000 outputs solution files in the binary <code class="docutils literal"><span class="pre">0.f%05d</span></code> format.  These can be read by both VisIt and ParaView in conjunction with a meta-data file.  For more information see <a class="reference internal" href="quickstart.html#qstart-vis"><span class="std std-ref">Visualization</span></a>.</div></blockquote>
<p><strong>I have calculated additional fields from my solution (e.g. vorticity), how do I visualize them?</strong></p>
<blockquote>
<div>Using the <code class="docutils literal"><span class="pre">.par</span></code> file, define an additional scalar and include <code class="docutils literal"><span class="pre">solver</span> <span class="pre">=</span> <span class="pre">none</span></code>, for example:</div></blockquote>
<div class="highlight-none"><div class="highlight"><pre><span></span>[SCALAR01] #vorticity
solver = none
</pre></div>
</div>
<blockquote>
<div>Then store the calculated field in <code class="docutils literal"><span class="pre">t(1,1,1,1,iscal+1)</span></code> where <code class="docutils literal"><span class="pre">iscal</span></code> is your passive scalar index (in this example 1).</div></blockquote>
<p><strong>How do I obtain values of variables at a specific point?</strong></p>
<blockquote>
<div>The simplest way is through the use of history points. See the section on the <a class="reference internal" href="case_files.html#case-files-his"><span class="std std-ref">History Points</span></a> file.</div></blockquote>
<p><strong>How do I compute an integral over a boundary patch?</strong></p>
<blockquote>
<div>The included subroutine <code class="docutils literal"><span class="pre">surface_int</span></code> can be called in a loop over the appropriate element faces.
This subroutine is further described in the section on <a class="reference internal" href="routines.html#append-subroutines"><span class="std std-ref">Commonly used Subroutines</span></a>.</div></blockquote>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="appendix.html" class="btn btn-neutral float-right" title="Appendices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="theory.html" class="btn btn-neutral" title="Theory" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, UCHICAGO ARGONNE, LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'17.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>